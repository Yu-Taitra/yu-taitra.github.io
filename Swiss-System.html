<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PTCG ç‘å£«åˆ¶é…å°ç³»çµ±</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap');

  :root {
    --bg: #0d0d0f;
    --surface: #141418;
    --surface2: #1c1c22;
    --border: #2a2a35;
    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --text: #e8e4dc;
    --muted: #7a7880;
    --win: #2ecc71;
    --loss: #e74c3c;
    --draw: #f39c12;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Crimson Pro', Georgia, serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(201,168,76,0.02) 40px, rgba(201,168,76,0.02) 41px),
      repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(201,168,76,0.02) 40px, rgba(201,168,76,0.02) 41px);
    pointer-events: none; z-index: 0;
  }

  /* â”€â”€ Timer bar (sticky) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #timer-bar {
    display: none;
    position: sticky; top: 0; z-index: 100;
    background: var(--surface);
    border-bottom: 2px solid var(--border);
    align-items: center;
    gap: 20px;
    padding: 10px 28px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.5);
  }
  #timer-bar.active { display: flex; }

  .timer-label {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 12px; letter-spacing: 4px; color: var(--muted);
    white-space: nowrap;
  }

  #timer-display {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 40px; letter-spacing: 4px;
    color: var(--gold-light);
    min-width: 108px; text-align: center;
    transition: color 0.4s;
  }
  #timer-display.warning { color: var(--draw); }
  #timer-display.urgent  { color: var(--loss); animation: pulse 0.8s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.35} }

  .timer-track {
    flex: 1; height: 5px; background: var(--border);
    border-radius: 3px; overflow: hidden; max-width: 280px;
  }
  #timer-fill {
    height: 100%; width: 100%;
    background: var(--gold); border-radius: 3px;
    transition: width 1s linear, background 0.5s;
  }
  #timer-fill.warning { background: var(--draw); }
  #timer-fill.urgent  { background: var(--loss); }

  .timer-btns { display: flex; gap: 8px; margin-left: auto; }
  .tbtn {
    font-family: 'Bebas Neue', sans-serif; font-size: 12px;
    letter-spacing: 2px; padding: 6px 14px;
    border: 1px solid var(--border); cursor: pointer;
    background: var(--surface2); color: var(--muted); transition: all 0.15s;
  }
  .tbtn:hover { border-color: var(--gold); color: var(--gold); }
  .tbtn.running { background: var(--gold); border-color: var(--gold); color: var(--bg); }

  /* Time-up overlay */
  #timeup-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.78); z-index: 300;
    align-items: center; justify-content: center;
  }
  #timeup-overlay.show { display: flex; }
  .timeup-box {
    background: #180808; border: 2px solid var(--loss);
    padding: 48px 56px; text-align: center; max-width: 420px;
  }
  .timeup-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 56px; letter-spacing: 4px; color: var(--loss); margin-bottom: 8px;
  }
  .timeup-sub { font-style: italic; color: var(--muted); font-size: 17px; margin-bottom: 20px; }
  .timeup-note { font-size: 14px; color: var(--muted); line-height: 1.7; margin-bottom: 24px; }

  /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .container { max-width: 980px; margin: 0 auto; padding: 40px 24px; position: relative; z-index: 1; }

  header { text-align: center; margin-bottom: 48px; }
  .title-label { font-family: 'Bebas Neue', sans-serif; font-size: 11px; letter-spacing: 6px; color: var(--gold); margin-bottom: 8px; }
  h1 { font-family: 'Bebas Neue', sans-serif; font-size: clamp(52px, 9vw, 88px); line-height: 0.9; letter-spacing: 4px; }
  h1 span { color: var(--gold); }
  .subtitle { font-style: italic; color: var(--muted); font-size: 17px; margin-top: 12px; }
  .divider { width: 80px; height: 2px; background: linear-gradient(90deg, transparent, var(--gold), transparent); margin: 24px auto; }

  .setup-panel { background: var(--surface); border: 1px solid var(--border); border-top: 3px solid var(--gold); padding: 32px; margin-bottom: 32px; }
  
  .config-row { display: flex; gap: 20px; margin-bottom: 32px; flex-wrap: wrap; }
  .config-item { flex: 1; min-width: 140px; }
  .config-item label { display: block; font-family: 'Bebas Neue', sans-serif; font-size: 14px; color: var(--gold); margin-bottom: 8px; letter-spacing: 2px; }
  .config-input { width: 100%; background: var(--bg); border: 1px solid var(--border); color: white; padding: 12px; outline: none; }
  
  .setup-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 3px; color: var(--gold); margin-bottom: 24px; }
  .players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(175px, 1fr)); gap: 10px; margin-bottom: 24px; }
  .player-input { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 10px 14px; font-family: 'Crimson Pro', serif; font-size: 16px; width: 100%; transition: border-color 0.2s; outline: none; }
  .player-input:focus { border-color: var(--gold); }

  .btn { font-family: 'Bebas Neue', sans-serif; font-size: 17px; letter-spacing: 3px; padding: 13px 32px; border: none; cursor: pointer; transition: all 0.2s; }
  .btn-primary { background: var(--gold); color: var(--bg); }
  .btn-primary:hover { background: var(--gold-light); transform: translateY(-1px); }
  .btn-secondary { background: transparent; color: var(--gold); border: 1px solid var(--gold); margin-left: 12px; }

  .tournament { display: none; }

  .round-section { margin-bottom: 40px; animation: slideIn 0.4s ease; }
  @keyframes slideIn { from { opacity:0; transform:translateY(14px); } to { opacity:1; transform:translateY(0); } }

  .round-header { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
  .round-badge { font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 4px; background: var(--gold); color: var(--bg); padding: 4px 16px; flex-shrink: 0; }
  .round-line { flex: 1; height: 1px; background: var(--border); }

  .matches-list { display: flex; flex-direction: column; gap: 6px; }

  .match-card {
    background: var(--surface); border: 1px solid var(--border);
    display: flex; align-items: stretch; min-height: 52px;
  }
  .match-table {
    font-family: 'Bebas Neue', sans-serif; font-size: 18px; color: var(--muted);
    width: 44px; flex-shrink: 0; border-right: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
  }
  .match-player {
    flex: 1; min-width: 0; padding: 14px 18px; font-size: 18px; font-weight: 600;
    display: flex; align-items: center;
  }
  .match-player-1 { justify-content: flex-end; }
  .match-vs {
    width: 64px; flex-shrink: 0; font-family: 'Bebas Neue', sans-serif; font-size: 18px; color: var(--muted);
    border-left: 1px solid var(--border); border-right: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
  }
  .result-area {
    width: 240px; flex-shrink: 0; display: flex; gap: 8px; padding: 10px 16px;
    align-items: center; justify-content: center; border-left: 1px solid var(--border);
  }

  .rbtn {
    font-family: 'Bebas Neue', sans-serif; font-size: 12px; letter-spacing: 1px;
    padding: 8px 0; border: 1px solid #4a5568; cursor: pointer;
    background: #2d3748; color: #a0aec0; transition: all 0.15s; flex: 1; text-align: center;
  }
  .rbtn.active-win { background: var(--win); border-color: var(--win); color: #000; }

  /* â”€â”€ Standings Table â”€â”€ */
  table { width: 100%; border-collapse: collapse; }
  thead tr { border-bottom: 2px solid var(--gold); }
  th { font-family: 'Bebas Neue', sans-serif; font-size: 12px; letter-spacing: 3px; color: var(--gold); text-align: center; padding: 10px 12px; font-weight: normal; }
  th:nth-child(2) { text-align: left; }
  tbody tr { border-bottom: 1px solid var(--border); transition: background 0.15s; }
  tbody tr:hover { background: var(--surface2); }
  td { padding: 11px 12px; font-size: 16px; text-align: center; }
  td:nth-child(2) { text-align: left; }
  
  .rank-num { font-family: 'Bebas Neue', sans-serif; font-size: 20px; color: var(--muted); }
  .rank-1 .rank-num { color: #ffd700; }
  .rank-2 .rank-num { color: #c0c0c0; }
  .rank-3 .rank-num { color: #cd7f32; }

  .player-name-cell { font-weight: 600; font-size: 17px; }
  .score-cell { font-family: 'Bebas Neue', sans-serif; font-size: 22px; color: var(--gold-light); }
  .wl { font-size: 14px; font-family: 'Crimson Pro', serif; }
  .wl .w { color: var(--win); }
  .wl .l { color: var(--loss); }
  .pct { font-size: 14px; color: var(--muted); font-variant-numeric: tabular-nums; }
  
  .dropped-row { background: #1a0a0a !important; color: #666; }

  .champion-banner {
    background: linear-gradient(135deg, #1a160a, #2a1f05);
    border: 1px solid var(--gold); padding: 40px; text-align: center; margin-bottom: 32px;
    position: relative; overflow: hidden;
  }
  .champion-label { font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 6px; color: var(--gold); margin-bottom: 8px; }
  .champion-name  { font-family: 'Bebas Neue', sans-serif; font-size: 56px; letter-spacing: 4px; color: var(--gold-light); }
  .champion-score { font-size: 19px; font-style: italic; color: var(--muted); margin-top: 8px; }

  /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  footer {
    margin-top: 80px;
    padding: 40px 0;
    text-align: center;
    border-top: 1px solid var(--border);
  }
  .credit-text {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 13px;
    letter-spacing: 3px;
    color: var(--muted);
  }
  .credit-text a {
    color: var(--gold);
    text-decoration: none;
    transition: color 0.2s;
    margin-left: 4px;
  }
  .credit-text a:hover {
    color: var(--gold-light);
    text-decoration: underline;
  }
  .powered-text {
    margin-top: 10px;
    font-family: 'Crimson Pro', serif;
    font-size: 12px;
    font-style: italic;
    color: var(--muted);
    opacity: 0.6;
  }

  @media (max-width: 640px) {
    .match-card { flex-wrap: wrap; }
    .result-area { width: 100%; border-left: none; border-top: 1px solid var(--border); }
  }
</style>
</head>
<body>

<div id="timer-bar">
  <div class="timer-label">å°å±€æ™‚é–“</div>
  <div id="timer-display">25:00</div>
  <div class="timer-track"><div id="timer-fill"></div></div>
  <div class="timer-btns">
    <button class="tbtn" id="tbtn-toggle" onclick="timerToggle()">é–‹å§‹</button>
    <button class="tbtn" onclick="timerReset()">é‡ç½®</button>
  </div>
</div>

<div id="timeup-overlay">
  <div class="timeup-box">
    <div class="timeup-title">â° æ™‚é–“åˆ°ï¼</div>
    <div class="timeup-sub">å°å±€æ™‚é–“çµæŸ</div>
    <div class="timeup-note">è«‹å„æ¡Œå®Œæˆç›®å‰é€²è¡Œä¸­çš„éŠæˆ²ï¼Œä¸¦ä¾ç•¶ä¸‹ç›¤é¢æ±ºå®šå‹è² å¾Œè¼¸å…¥çµæœã€‚</div>
    <button class="btn btn-secondary" style="margin:0" onclick="dismissTimeup()">ç¢ºèªçŸ¥æ‚‰</button>
  </div>
</div>

<div class="container">
  <header>
    <div class="title-label">Playï¼ PokÃ©mon Official Rules</div>
    <h1>ç‘å£«åˆ¶<br><span>é…å°ç³»çµ±</span></h1>
    <p class="subtitle">å½ˆæ€§é…ç½® Â· PTCG å®˜æ–¹è¦å‰‡</p>
    <div class="divider"></div>
  </header>

  <div id="setup-panel" class="setup-panel">
    <div class="config-row">
      <div class="config-item">
        <label>åƒè³½äººæ•¸</label>
        <input type="number" id="cfg-players" class="config-input" value="16" onchange="updateGrid()">
      </div>
      <div class="config-item">
        <label>æ¯”è³½è¼ªæ¬¡</label>
        <input type="number" id="cfg-rounds" class="config-input" value="4">
      </div>
      <div class="config-item">
        <label>é›™æ•—æ·˜æ±°</label>
        <select id="cfg-drop" class="config-input">
          <option value="none" selected>é—œé–‰ï¼ˆç‘å£«åˆ¶ï¼‰</option>
          <option value="double">é–‹å•Ÿï¼ˆäºŒæ•—æ·˜æ±°ï¼‰</option>
        </select>
      </div>
    </div>
    
    <div class="setup-title">â–¸ è¼¸å…¥åƒè³½è€…åå–®</div>
    <div class="players-grid" id="players-grid"></div>
    <button class="btn btn-primary" onclick="startTournament()">é–‹å§‹æ¯”è³½</button>
    <button class="btn btn-secondary" onclick="fillSample()">å¡«å…¥é¸æ‰‹ç·¨è™Ÿ</button>
  </div>

  <div id="tournament" class="tournament">
    <div id="rounds-container"></div>
    <div id="standings-container"></div>
  </div>

  <footer>
    <div class="credit-text">
      Created by <a href="https://www.threads.com/@yu__03.07" target="_blank">å°å®‡ï¼ˆï¼ yu__03.07ï¼‰</a>
    </div>
    <div class="powered-text">
      Powered By Claude Sonnet 4.6ã€Gemini 3 Flashï¼ˆVibe Codingï¼‰
    </div>
  </footer>
</div>

<script>
// --- Core Logic ---
let players = [], rounds = [], currentRound = 0;
let totalRounds = 4, dropMode = 'none';
const ROUND_SECONDS = 25 * 60;

let timerSecsLeft = ROUND_SECONDS, timerRunning = false, timerInterval = null;

function timerTick() {
  if (!timerRunning) return;
  timerSecsLeft--; updateTimerUI();
  if (timerSecsLeft <= 0) {
    timerRunning = false; clearInterval(timerInterval);
    document.getElementById('tbtn-toggle').textContent = 'é–‹å§‹';
    document.getElementById('timeup-overlay').classList.add('show');
  }
}
function timerToggle() {
  if (timerSecsLeft <= 0) return;
  timerRunning = !timerRunning;
  const btn = document.getElementById('tbtn-toggle');
  if (timerRunning) {
    btn.textContent = 'æš«åœ'; btn.classList.add('running');
    timerInterval = setInterval(timerTick, 1000);
  } else {
    btn.textContent = 'ç¹¼çºŒ'; btn.classList.remove('running');
    clearInterval(timerInterval); timerInterval = null;
  }
}
function timerReset() {
  timerRunning = false; clearInterval(timerInterval);
  timerSecsLeft = ROUND_SECONDS; updateTimerUI();
  document.getElementById('tbtn-toggle').textContent = 'é–‹å§‹';
  document.getElementById('timeup-overlay').classList.remove('show');
}
function updateTimerUI() {
  const m = Math.floor(timerSecsLeft/60), s = timerSecsLeft%60;
  const disp = document.getElementById('timer-display'), fill = document.getElementById('timer-fill');
  disp.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  fill.style.width = (timerSecsLeft/ROUND_SECONDS*100)+'%';
  disp.className = timerSecsLeft <= 60 ? 'urgent' : timerSecsLeft <= 300 ? 'warning' : '';
}
function dismissTimeup() { document.getElementById('timeup-overlay').classList.remove('show'); }

function updateGrid() {
  const n = parseInt(document.getElementById('cfg-players').value) || 0;
  const grid = document.getElementById('players-grid');
  grid.innerHTML = '';
  for(let i=0; i<n; i++) {
    const inp = document.createElement('input');
    inp.className = 'player-input'; inp.placeholder = `é¸æ‰‹ ${i+1}`; inp.id = `pi-${i}`;
    grid.appendChild(inp);
  }
  document.getElementById('cfg-rounds').value = Math.ceil(Math.log2(n));
}
updateGrid();

function fillSample() {
  const n = parseInt(document.getElementById('cfg-players').value);
  for(let i=0; i<n; i++) document.getElementById(`pi-${i}`).value = `é¸æ‰‹ ${i+1}`;
}

function getStats(pid) {
  let pts = 0, wins = 0, losses = 0, nonByeMatches = 0, hasBye = false;
  rounds.forEach(r => r.forEach(m => {
    if(m.bye === pid) { pts += 3; wins++; hasBye = true; }
    else if(m.p1 === pid || m.p2 === pid) {
      if(!m.result) return;
      nonByeMatches++;
      const win = (m.p1 === pid && m.result === '1') || (m.p2 === pid && m.result === '2');
      win ? (pts += 3, wins++) : losses++;
    }
  }));
  if(dropMode === 'double' && losses >= 2) players[pid].dropped = true;
  return { pts, wins, losses, nonByeMatches, hasBye };
}

function winPct(pid) {
  const s = getStats(pid);
  if(s.nonByeMatches === 0) return 0.25;
  const raw = (s.wins - (s.hasBye ? 1 : 0)) / s.nonByeMatches;
  return Math.min(0.75, Math.max(0.25, raw));
}

function getOpWinPct(pid) {
  let opps = [];
  rounds.forEach(r => r.forEach(m => {
    if(m.p1 === pid) opps.push(m.p2); else if(m.p2 === pid) opps.push(m.p1);
  }));
  if(!opps.length) return 0.25;
  return opps.reduce((sum, oid) => sum + winPct(oid), 0) / opps.length;
}

function getOpOpWinPct(pid) {
  let opps = [];
  rounds.forEach(r => r.forEach(m => {
    if(m.p1 === pid) opps.push(m.p2); else if(m.p2 === pid) opps.push(m.p1);
  }));
  if(!opps.length) return 0.25;
  return opps.reduce((sum, oid) => sum + getOpWinPct(oid), 0) / opps.length;
}

function getSortedIds() {
  return players.map(p => p.id).sort((a,b) => {
    if(players[a].dropped !== players[b].dropped) return players[a].dropped ? 1 : -1;
    const sa = getStats(a), sb = getStats(b);
    if(sb.pts !== sa.pts) return sb.pts - sa.pts;
    const oa = getOpWinPct(a), ob = getOpWinPct(b);
    if(Math.abs(ob - oa) > 1e-9) return ob - oa;
    return getOpOpWinPct(b) - getOpOpWinPct(a);
  });
}

function makePairings() {
  const sorted = getSortedIds().filter(id => !players[id].dropped);
  const paired = new Set(), matches = [];
  if(sorted.length % 2 !== 0) {
    for(let i = sorted.length - 1; i >= 0; i--) {
      const pid = sorted[i];
      if(!rounds.some(r => r.some(m => m.bye === pid))) {
        matches.push({ bye: pid }); paired.add(pid); break;
      }
    }
  }
  let pool = sorted.filter(id => !paired.has(id));
  while(pool.length > 0) {
    const p1 = pool.shift();
    let p2 = null;
    for(let j=0; j < pool.length; j++) {
      if(!players[p1].history.has(pool[j])) {
        p2 = pool.splice(j, 1)[0]; break;
      }
    }
    if(p2 === null && pool.length > 0) p2 = pool.shift();
    if(p2 !== null) {
      matches.push({ p1, p2, result: null });
      players[p1].history.add(p2); players[p2].history.add(p1);
    } else { matches.push({ bye: p1 }); }
  }
  return matches;
}

function startTournament() {
  const n = parseInt(document.getElementById('cfg-players').value);
  totalRounds = parseInt(document.getElementById('cfg-rounds').value);
  dropMode = document.getElementById('cfg-drop').value;
  players = Array.from({length: n}, (_, i) => ({
    id: i, name: document.getElementById(`pi-${i}`).value.trim() || `é¸æ‰‹ ${i+1}`,
    dropped: false, history: new Set()
  }));
  document.getElementById('setup-panel').style.display = 'none';
  document.getElementById('tournament').style.display = 'block';
  document.getElementById('timer-bar').classList.add('active');
  doNextRound();
}

function doNextRound() {
  if(currentRound >= totalRounds) return;
  rounds.push(makePairings());
  renderRound(currentRound++);
  renderStandings();
  timerReset();
}

function renderRound(ri) {
  const container = document.getElementById('rounds-container');
  const sec = document.createElement('div'); sec.className = 'round-section';
  let t = 1;
  const html = rounds[ri].map((m, mi) => {
    if(m.bye !== undefined) return `<div class="match-card bye"><div class="match-table">BYE</div><div class="bye-text">ğŸ¯ ${players[m.bye].name}ï¼ˆè¼ªç©ºï¼‰</div></div>`;
    return `<div class="match-card">
      <div class="match-table">${t++}</div>
      <div class="match-player match-player-1">${players[m.p1].name}</div>
      <div class="match-vs">VS</div>
      <div class="match-player">${players[m.p2].name}</div>
      <div class="result-area">
        <button class="rbtn" id="rb1-${ri}-${mi}" onclick="setResult(${ri},${mi},'1')">â—€ å‹</button>
        <button class="rbtn" id="rb2-${ri}-${mi}" onclick="setResult(${ri},${mi},'2')">å‹ â–¶</button>
      </div>
    </div>`;
  }).join('');
  const isLast = ri === totalRounds - 1;
  sec.innerHTML = `<div class="round-header"><div class="round-badge">ç¬¬ ${ri+1} è¼ª</div><div class="round-line"></div></div><div class="matches-list">${html}</div><div class="round-controls"><button class="btn btn-primary btn-small" id="btn-${ri}" style="display:none" onclick="${isLast ? 'showFinal()' : 'doNextRound()'}">${isLast ? 'æŸ¥çœ‹æ’å' : 'ä¸‹ä¸€è¼ª â†’'}</button></div>`;
  container.appendChild(sec);
}

function setResult(ri, mi, win) {
  rounds[ri][mi].result = win;
  document.getElementById(`rb1-${ri}-${mi}`).classList.toggle('active-win', win === '1');
  document.getElementById(`rb2-${ri}-${mi}`).classList.toggle('active-win', win === '2');
  renderStandings();
  if(rounds[ri].every(m => m.bye !== undefined || m.result)) document.getElementById(`btn-${ri}`).style.display = 'inline-block';
}

function renderStandings() {
  const container = document.getElementById('standings-container');
  container.innerHTML = '';
  const ids = getSortedIds();
  const rows = ids.map((pid, idx) => {
    const s = getStats(pid), ow = getOpWinPct(pid), oow = getOpOpWinPct(pid), p = players[pid];
    const rankLabel = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][idx] || idx + 1;
    const rankClass = ['rank-1','rank-2','rank-3'][idx] || '';

    return `<tr class="${rankClass} ${p.dropped ? 'dropped-row' : ''}">
      <td class="rank-num">${rankLabel}</td>
      <td class="player-name-cell">${p.name} ${p.dropped ? 'ï¼ˆOUTï¼‰' : ''}</td>
      <td class="score-cell">${s.pts}</td>
      <td class="wl"><span class="w">${s.wins}å‹</span> <span class="l">${s.losses}è² </span></td>
      <td class="pct">${(ow*100).toFixed(1)}%</td>
      <td class="pct">${(oow*100).toFixed(1)}%</td>
    </tr>`;
  }).join('');
  container.innerHTML = `<div class="standings-title">æ’å</div><table><thead><tr><th>åæ¬¡</th><th>é¸æ‰‹</th><th>ç©åˆ†</th><th>å‹/è² </th><th>Op Win%</th><th>Op-Op Win%</th></tr></thead><tbody>${rows}</tbody></table>`;
}

function showFinal() {
  const winner = getSortedIds()[0];
  const s = getStats(winner);
  document.getElementById('rounds-container').innerHTML = `<div class="champion-banner"><div class="champion-label">ğŸ† CHAMPION</div><div class="champion-name">${players[winner].name}</div><div class="champion-score">${s.pts} ç©åˆ† Â· ${s.wins}å‹ ${s.losses}è² </div><button class="btn btn-secondary" onclick="location.reload()" style="margin-top:20px">é‡æ–°é–‹å§‹</button></div>`;
  renderStandings();
}
</script>
</body>

</html>
